#!/usr/bin/python

import path
from pypybuilder import config

from py.execnet import SshGateway

if __name__ == '__main__':
    from py.execnet import SshGateway
    from pypybuilder.server import init

    gw = SshGateway(config.server)
    channel = init(gw, port=config.port, path=config.path, 
                    projectname=config.projectname,
                    buildpath=str(config.buildpath),
                    mailhost=config.mailhost,
                    mailport=config.mailport,
                    mailfrom=config.mailfrom)

    try:
        while 1:
            data = channel.receive()
            assert isinstance(data, str)
            print data
    finally:
        channel.close()
        gw.exit()
